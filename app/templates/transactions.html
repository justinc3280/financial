{% extends "base.html" %}

{% block content %}

<h4>Transactions</h4>
{% if transactions %}
	<table class="table table-bordered">
		<thead>
			<tr>
				<th>Date</th>
				<th>Amount</th>
				<th>Description</th>
				<th>Category</th>
			</tr>
		</thead>
		<tbody>
			{% for transaction in transactions | sort(attribute='date') %}
				<tr>
					<td>{{ transaction.date | date }}</td>
					<td>{{ transaction.amount | money }}</td>
					<td>{{ transaction.description }}</td>
					<td>
						<div id="category_name_{{ transaction.id }}">{{ transaction.category.name }}</div>
						{% set url = url_for('edit_category', transaction_id=transaction.id) | string %}
						<button type="button" id="openModal{{ transaction.id }}" class="fa fa-pencil-square-o" data-url={{ url }} onclick="getEditCategoryModal({{ transaction.id }})"></button>
					</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>
{% else %}
  No transactions to display
{% endif %}

<div id="modal_slot" role="dialog"></div>

<script>

	function getEditCategoryModal(transaction_id) {
		$button = $('#openModal'+transaction_id);
		url = $button.attr('data-url');

		$.ajax({type:'POST', url:url, success: function(response) {
				$("#modal_slot").html(response)
				$("#modal_slot").find(".modal").modal('show');
		}})
	}

	function submitForm(transaction_id) {
			$form = $('#editCategory' + transaction_id);
			var url_name = $form.attr('data-url');
			console.log(url_name)
			category_name_display = $('#category_name_' + transaction_id);

	    $.ajax({type:'POST', url: url_name, data:$form.serialize(), success: function(response) {
					category_name_display.html(response);
	    }});

			$("#modal_slot").find(".modal").modal('hide');
	    return false;
	}
</script>
{% endblock %}
